@extends('layouts.admin')
@section('content')
    <div class="container-fluid">
        <div class="row">
            @include('admin.sidebar')
            <div class="col-md-9">
                <h1 class="mt-4">Admin Panel</h1>
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item active">Database editor</li>
                </ol>
                @if(session('success'))
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <strong>Success!</strong> {{ session('success') }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                @endif
                @if ($errors->any())
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        @foreach ($errors->all() as $error)
                            {{ $error }}
                        @endforeach
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                @endif
                <div class="card mb-4">
                    <div class="card-header">
                        Table Users
                    </div>
                    <div class="card-body ">
                        <div class="table-responsive">
                            <table class="table" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Created at</th>
                                    <th>Muted until</th>
                                </tr>
                                </thead>
                                <tbody>
                                @foreach($users as $user)
                                    <tr class="dd">
                                            <td>{{$user->name}}</td>
                                            <td>{{$user->email}}</td>
                                            <td>{{$user->created_at}}</td>
                                            <td>@if($user->mute != null) {{$user->mute->mute_time}} @else None @endif</td>
                                            <td><button data-id="{{$user->id}}" data-toggle="modal" data-target="#modal" title="Mute" class="btn btn-secondary d-inline pb-2 modal-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-mute" viewBox="0 0 16 16">
                                                        <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zM6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96V5.04zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"/>
                                                    </svg>
                                                </button>

                                                @if(!$user->roles->contains(3) && \Illuminate\Support\Facades\Auth::user()->roles->contains(3))
                                                <form  class="d-inline" action="{{route('admin.users.moder')}}"  method="post">
                                                    @csrf
                                                    @method('PUT')

                                                    @if(!$user->roles->contains(2))
                                                        <button title="Add moder" type="submit" class="btn btn-success">
                                                            +
                                                        </button>
                                                    @elseif($user->roles->contains(2))
                                                        <button title="Delete moder" type="submit" class="btn btn-danger">
                                                            -
                                                        </button>
                                                    @endif


                                                    <input name="user_id" type="hidden" value="{{$user->id}}">
                                                    @if(!$user->roles->contains(2))
                                                        <input name="delete" type="hidden" value="0">
                                                    @elseif($user->roles->contains(2))
                                                        <input name="delete" type="hidden" value="1">
                                                    @endif
                                                </form>
                                                @endif

                                                <form  class="d-inline" action="{{route('admin.users.delete',$user->id)}}"  method="post">
                                                    @csrf
                                                    @method('DELETE')
                                                    <button title="Delete" type="submit" class="btn btn-danger"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                                        </svg>
                                                    </button>
                                                </form>
                                            </td>
                                    </tr>
                                @endforeach
                                </tbody>
                            </table>
                            {{ $users->onEachSide(3)->links() }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        Mute user
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="" method="post" enctype="multipart/form-data">
                        @csrf
                        <h3>Mute</h3>
                        <div class="form-group">
                            <label>Mute until</label>
                        </div>
                        <input type="datetime-local" required name="datetime" id="datetime"/>
                        <input type="hidden" name="user_id" id="user_id" />
                        <input type="hidden" name="page" id="page" value="{{$users->currentPage()}}" />
                        <button type="submit" class="btn btn-primary">Mute</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(".modal-button").click(function () {
            $('#user_id').val($(this).data('id'));
        });
    </script>
@endsection
